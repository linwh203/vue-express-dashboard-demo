"use strict";(globalThis["webpackChunkweb"]=globalThis["webpackChunkweb"]||[]).push([[539],{539:(e,l,a)=>{a.r(l),a.d(l,{default:()=>R});var t=a(9835),s=a(6970),n=a(1957),o=a(1569),i=a(499),u=a(9302);const d={class:"q-pa-md full-width full-height"},r={class:"flex full-width justify-between items-center"},c=(0,t._)("div",{class:"text-h5 text-primary text-weight-bold q-pb-md"}," User Management ",-1),m={class:"flex q-gutter-lg"},p={class:"q-mt-md"},v=(0,t._)("div",{class:"text-h6"},"ADD USER",-1),g=["onSubmit"],f={class:"flex items-center q-gutter-lg q-px-lg q-pt-md"},w=(0,t._)("span",null,"Role: ",-1),h={class:"text-right q-gutter-lg q-pt-lg"},b=(0,t._)("div",{class:"text-h6"},"DELETE USER!",-1),y=(0,t._)("p",null,"Are you sure to delete user:",-1),q={__name:"UserManage",setup(e){const l=(0,u.Z)(),a=(0,i.iH)([]),q=[{name:"id",label:"User ID",align:"left",field:e=>e.id,format:e=>`${e}`,sortable:!0},{name:"username",label:"User Name",align:"left",field:e=>e.username,sortable:!0},{name:"password",label:"Password",align:"left",field:e=>e.password,sortable:!1},{name:"role",label:"User Role",align:"left",field:"role"}],_=(0,i.iH)([]),W=(0,i.iH)(!1),U=(0,i.iH)(""),V=(0,i.iH)(!1),x=(0,i.iH)(!1),k=(0,i.iH)(""),C=(0,i.iH)(""),Z=(0,i.iH)("user");function Q(){x.value=!0}function E(){a.value.length&&(V.value=!0)}function H(){k.value="",C.value=""}async function S(){W.value=!0;try{x.value=!1;const{data:e}=await o.api.post("/addUser",{username:k.value,password:C.value,role:Z.value});0!==e.code?l.notify({type:"negative",message:"add user failed: "+e.msg,position:"center"}):(l.notify({type:"positive",message:"add user success",position:"center",timeout:2e3}),k.value="",C.value="",T()),W.value=!1}catch(e){l.notify({type:"negative",message:"add user failed: "+e,position:"center"}),W.value=!1}}async function A(){if(a.value.some((e=>"admin"==e.role)))l.notify({type:"negative",message:"can not delete admin user",position:"center",timeout:2e3});else try{const{data:e}=await o.api.post("/deleteUser",{id:a.value.map((e=>e.id))});0!==e.code?l.notify({type:"negative",message:"delete user failed: "+e.msg,position:"center"}):(l.notify({type:"positive",message:"delete user success",position:"center",timeout:2e3}),T())}catch(e){l.notify({type:"negative",message:"delete user failed: "+e,position:"center"})}}function D(){return 0===a.value.length?"":`${a.value.length} record${a.value.length>1?"s":""} selected of ${_.value.length}`}async function T(){const{data:e}=await o.api.get("/getUserList");0!=e.code?l.notify({type:"negative",position:"top",message:e.msg}):_.value=e.data,W.value=!1}return(0,t.bv)((()=>{W.value=!0,setTimeout((()=>{T()}),500)})),(e,l)=>{const o=(0,t.up)("q-btn"),i=(0,t.up)("q-space"),u=(0,t.up)("q-icon"),T=(0,t.up)("q-input"),L=(0,t.up)("q-inner-loading"),R=(0,t.up)("q-table"),j=(0,t.up)("q-card-section"),I=(0,t.up)("q-radio"),M=(0,t.up)("q-card"),P=(0,t.up)("q-dialog"),$=(0,t.up)("q-card-actions"),N=(0,t.up)("q-page"),z=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(N,{class:"full-width full-height"},{default:(0,t.w5)((()=>[(0,t._)("div",d,[(0,t.Wm)(R,{title:"User Management",rows:_.value,columns:q,"row-key":"id","selected-rows-label":D,selection:"multiple",selected:a.value,"onUpdate:selected":l[1]||(l[1]=e=>a.value=e),loading:W.value,"rows-per-page-options":[10,20],filter:U.value,"table-class":"myTable"},{top:(0,t.w5)((()=>[(0,t._)("div",r,[c,(0,t._)("div",m,[(0,t.Wm)(o,{color:"secondary",disable:W.value,label:"Add User",onClick:Q},null,8,["disable"]),(0,t.Wm)(o,{class:"q-ml-sm",color:"negative",disable:W.value,label:"Delete User",onClick:E},null,8,["disable"]),(0,t.Wm)(i),(0,t.Wm)(T,{dense:"",placeholder:"Search user name",debounce:"300",color:"primary",modelValue:U.value,"onUpdate:modelValue":l[0]||(l[0]=e=>U.value=e)},{append:(0,t.w5)((()=>[(0,t.Wm)(u,{name:"search"})])),_:1},8,["modelValue"])])])])),loading:(0,t.w5)((()=>[(0,t.Wm)(L,{showing:"",color:"primary"})])),_:1},8,["rows","selected","loading","filter"]),(0,t._)("div",p," Selected User: "+(0,s.zw)(a.value.length?a.value.map((e=>e.username)).join(", "):""),1)]),(0,t.Wm)(P,{modelValue:x.value,"onUpdate:modelValue":l[6]||(l[6]=e=>x.value=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{class:"bg-secondary text-white",style:{width:"500px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(j,null,{default:(0,t.w5)((()=>[v])),_:1}),(0,t._)("form",{onSubmit:(0,n.iM)(S,["prevent","stop"]),class:"q-gutter-md q-pa-lg"},[(0,t.Wm)(T,{dark:"",modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=e=>k.value=e),filled:"",required:"",type:"text",hint:"Username"},null,8,["modelValue"]),(0,t.Wm)(T,{dark:"",modelValue:C.value,"onUpdate:modelValue":l[3]||(l[3]=e=>C.value=e),filled:"",type:"password",hint:"Password"},null,8,["modelValue"]),(0,t._)("div",f,[w,(0,t.Wm)(I,{modelValue:Z.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Z.value=e),val:"admin",label:"admin",dark:"",color:"dark"},null,8,["modelValue"]),(0,t.Wm)(I,{modelValue:Z.value,"onUpdate:modelValue":l[5]||(l[5]=e=>Z.value=e),val:"user",label:"user",dark:"",color:"dark"},null,8,["modelValue"])]),(0,t._)("div",h,[(0,t.Wm)(o,{label:"Add",type:"submit",color:"secondary"}),(0,t.wy)((0,t.Wm)(o,{flat:"",label:"CANCEL",color:"white",onClick:H},null,512),[[z]])])],40,g),(0,t.Wm)(j,{class:"q-pt-none"})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(P,{modelValue:V.value,"onUpdate:modelValue":l[7]||(l[7]=e=>V.value=e),persistent:"","transition-show":"scale","transition-hide":"scale"},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{class:"bg-negative text-white",style:{width:"500px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(j,null,{default:(0,t.w5)((()=>[b])),_:1}),(0,t.Wm)(j,{class:"q-pt-none"},{default:(0,t.w5)((()=>[y,(0,t._)("p",null,(0,s.zw)(a.value.length?a.value.map((e=>e.username)).join(", "):""),1)])),_:1}),(0,t.Wm)($,{align:"right",class:"bg-white text-teal"},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(o,{flat:"",label:"DELETE",color:"negative",onClick:A},null,512),[[z]]),(0,t.wy)((0,t.Wm)(o,{flat:"",label:"CANCEL",color:"secondary"},null,512),[[z]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})}}};var _=a(9885),W=a(2145),U=a(4455),V=a(136),x=a(6611),k=a(2857),C=a(854),Z=a(2074),Q=a(4458),E=a(3190),H=a(1480),S=a(1821),A=a(2146),D=a(9984),T=a.n(D);const L=q,R=L;T()(q,"components",{QPage:_.Z,QTable:W.Z,QBtn:U.Z,QSpace:V.Z,QInput:x.Z,QIcon:k.Z,QInnerLoading:C.Z,QDialog:Z.Z,QCard:Q.Z,QCardSection:E.Z,QRadio:H.Z,QCardActions:S.Z}),T()(q,"directives",{ClosePopup:A.Z})}}]);