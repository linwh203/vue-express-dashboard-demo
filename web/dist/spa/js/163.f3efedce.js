"use strict";(globalThis["webpackChunkweb"]=globalThis["webpackChunkweb"]||[]).push([[163],{9163:(e,a,l)=>{l.r(a),l.d(a,{default:()=>q});l(6727);var t=l(9835),o=l(1569),i=l(499),n=l(9302),u=l(4170),s=l(6646);const r={class:"q-pa-md full-width full-height"},m={class:"flex full-width justify-between items-center"},d=(0,t._)("div",{class:"text-h5 text-primary text-weight-bold q-pb-md"}," Login Audit ",-1),c={class:"flex q-gutter-lg"},p={class:"row items-center justify-end"},f={__name:"LoginAudit",setup(e){const a=[{name:"time",label:"Login Time",align:"left",field:e=>e.time,format:e=>u.ZP.formatDate(e,"YYYY-MM-DD HH:mm:ss"),sortable:!0},{name:"id",label:"User ID",align:"left",field:e=>e.id,format:e=>`${e}`,sortable:!0},{name:"username",label:"User Name",align:"left",field:e=>e.username,sortable:!0},{name:"type",label:"User Action",align:"left",field:e=>e.type,sortable:!1}],l=(0,n.Z)(),f=(0,i.iH)([]),v=(0,i.iH)(!1),g=(0,i.iH)(!1);let b=u.ZP.buildDate({hours:0,minutes:0,seconds:0});b=u.ZP.subtractFromDate(b,{days:7});let w=u.ZP.buildDate({hours:23,minutes:59,seconds:59});const D=(0,i.iH)(b.getTime()),Y=(0,i.iH)(w.getTime()),y=(0,i.iH)({from:u.ZP.formatDate(b,"YYYY/MM/DD"),to:u.ZP.formatDate(w,"YYYY/MM/DD")}),h=(0,i.iH)(""),Z=(0,t.Fl)((()=>{const e=f.value.filter((e=>e.username.toLowerCase().includes(h.value.trim().toLowerCase())));return console.log(e),e}));async function T(){if(Z.value.length){const t=[a.map((a=>e(a.label)))].concat(Z.value.map((l=>a.map((a=>e("function"===typeof a.field?a.field(l):l[void 0===a.field?a.name:a.field],a.format,l))).join(",")))).join("\r\n"),o=(0,s.Z)(`login-audit_${u.ZP.formatDate(b,"YYYY-MM-DD")}-${u.ZP.formatDate(w,"YYYY-MM-DD")}.csv`,t,"text/csv");!0!==o&&l.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}else l.notify({type:"negative",message:"no data available for export...",position:"top"});function e(e,a,l){let t=void 0!==a?a(e,l):e;return t=void 0===t||null===t?"":String(t),t=t.split('"').join('""'),`"${t}"`}}function M(){console.log(y.value);const{from:e,to:a}=y.value;e&&a?(D.value=new Date(`${e} 00:00:00`).getTime(),Y.value=new Date(`${a} 23:59:59`).getTime()):(D.value=new Date(`${y.value} 00:00:00`).getTime(),Y.value=new Date(`${y.value} 23:59:59`).getTime()),g.value=!1,v.value=!0,_()}function P(){D.value=b.getTime(),Y.value=w.getTime(),y.value=Object.assign({from:u.ZP.formatDate(b,"YYYY/MM/DD"),to:u.ZP.formatDate(w,"YYYY/MM/DD")},{}),g.value=!1,v.value=!0,_()}async function _(){const{data:e}=await o.api.post("/getAuditLog",{startTime:D.value,endTime:Y.value});0!=e.code?l.notify({type:"negative",position:"top",message:e.msg}):f.value=e.data,v.value=!1}return(0,t.bv)((()=>{v.value=!0,setTimeout((()=>{_()}),500)})),(e,l)=>{const o=(0,t.up)("q-btn"),i=(0,t.up)("q-date"),n=(0,t.up)("q-popup-proxy"),u=(0,t.up)("q-space"),s=(0,t.up)("q-icon"),b=(0,t.up)("q-input"),w=(0,t.up)("q-inner-loading"),D=(0,t.up)("q-table"),Y=(0,t.up)("q-page"),Z=(0,t.Q2)("close-popup");return(0,t.wg)(),(0,t.j4)(Y,{class:"full-width full-height"},{default:(0,t.w5)((()=>[(0,t._)("div",r,[(0,t.Wm)(D,{title:"Login Audit",rows:f.value,columns:a,"row-key":"time",loading:v.value,"rows-per-page-options":[20,40],filter:h.value,"table-class":"myTable"},{top:(0,t.w5)((()=>[(0,t._)("div",m,[d,(0,t._)("div",c,[(0,t.Wm)(o,{color:"primary",label:"Select Date"},{default:(0,t.w5)((()=>[(0,t.Wm)(n,{cover:"","transition-show":"scale","transition-hide":"scale",modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=e=>g.value=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=e=>y.value=e),range:""},{default:(0,t.w5)((()=>[(0,t._)("div",p,[(0,t.wy)((0,t.Wm)(o,{label:"Close",color:"dark",flat:""},null,512),[[Z]]),(0,t.Wm)(o,{onClick:P,label:"Reset",color:"secondary",flat:""}),(0,t.Wm)(o,{onClick:M,label:"OK",color:"primary",flat:""})])])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(o,{color:"secondary",disable:v.value,label:"Export CSV",onClick:T},null,8,["disable"]),(0,t.Wm)(u),(0,t.Wm)(b,{dense:"",placeholder:"Search user name",debounce:"300",color:"primary",modelValue:h.value,"onUpdate:modelValue":l[2]||(l[2]=e=>h.value=e)},{append:(0,t.w5)((()=>[(0,t.Wm)(s,{name:"search"})])),_:1},8,["modelValue"])])])])),loading:(0,t.w5)((()=>[(0,t.Wm)(w,{showing:"",color:"primary"})])),_:1},8,["rows","loading","filter"])])])),_:1})}}};var v=l(9885),g=l(2145),b=l(4455),w=l(2765),D=l(6711),Y=l(136),y=l(6611),h=l(2857),Z=l(854),T=l(2146),M=l(9984),P=l.n(M);const _=f,q=_;P()(f,"components",{QPage:v.Z,QTable:g.Z,QBtn:b.Z,QPopupProxy:w.Z,QDate:D.Z,QSpace:Y.Z,QInput:y.Z,QIcon:h.Z,QInnerLoading:Z.Z}),P()(f,"directives",{ClosePopup:T.Z})}}]);